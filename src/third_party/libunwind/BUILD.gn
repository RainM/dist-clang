source_set("unwind") {
  sources = [
    "exported/src/mi/_ReadULEB.c",
    "exported/src/mi/_ReadSLEB.c",
    "exported/src/mi/backtrace.c",
    "exported/src/mi/dyn-cancel.c",
    "exported/src/mi/dyn-info-list.c",
    "exported/src/mi/dyn-register.c",
    "exported/src/mi/Ldestroy_addr_space.c",
    "exported/src/mi/Ldyn-extract.c",
    "exported/src/mi/Lfind_dynamic_proc_info.c",
    "exported/src/mi/Lget_accessors.c",
    "exported/src/mi/Lget_fpreg.c",
    "exported/src/mi/Lget_proc_info_by_ip.c",
    "exported/src/mi/Lget_proc_name.c",
    "exported/src/mi/Lget_reg.c",
    "exported/src/mi/Lput_dynamic_unwind_info.c",
    "exported/src/mi/Lset_caching_policy.c",
    "exported/src/mi/Lset_fpreg.c",
    "exported/src/mi/Lset_reg.c",
    "exported/src/unwind/Backtrace.c",
    "exported/src/unwind/DeleteException.c",
    "exported/src/unwind/FindEnclosingFunction.c",
    "exported/src/unwind/ForcedUnwind.c",
    "exported/src/unwind/GetBSP.c",
    "exported/src/unwind/GetCFA.c",
    "exported/src/unwind/GetDataRelBase.c",
    "exported/src/unwind/GetGR.c",
    "exported/src/unwind/GetIP.c",
    "exported/src/unwind/GetIPInfo.c",
    "exported/src/unwind/GetLanguageSpecificData.c",
    "exported/src/unwind/GetRegionStart.c",
    "exported/src/unwind/GetTextRelBase.c",
    "exported/src/unwind/RaiseException.c",
    "exported/src/unwind/Resume.c",
    "exported/src/unwind/Resume_or_Rethrow.c",
    "exported/src/unwind/SetGR.c",
    "exported/src/unwind/SetIP.c",
    "exported/src/x86_64/getcontext.S",
    "exported/src/x86_64/Lcreate_addr_space.c",
    "exported/src/x86_64/Lget_proc_info.c",
    "exported/src/x86_64/Lget_save_loc.c",
    "exported/src/x86_64/Lglobal.c",
    "exported/src/x86_64/Linit.c",
    "exported/src/x86_64/Linit_local.c",
    "exported/src/x86_64/Linit_remote.c",
    "exported/src/x86_64/Los-linux.c",
    "exported/src/x86_64/Lregs.c",
    "exported/src/x86_64/Lresume.c",
    "exported/src/x86_64/Lstash_frame.c",
    "exported/src/x86_64/Lstep.c",
    "exported/src/x86_64/Ltrace.c",
    "exported/src/x86_64/setcontext.S",

    # dwarf-generic + dwarf-common + dwarf-local
    "exported/src/dwarf/global.c",
    "exported/src/dwarf/Gexpr.c",
    "exported/src/dwarf/Gfde.c",
    "exported/src/dwarf/Gparser.c",
    "exported/src/dwarf/Gpe.c",
    "exported/src/dwarf/Gstep.c",
    "exported/src/dwarf/Gfind_proc_info-lsb.c",
    "exported/src/dwarf/Gfind_unwind_table.c",
    "exported/src/dwarf/Lexpr.c",
    "exported/src/dwarf/Lfde.c",
    "exported/src/dwarf/Lfind_proc_info-lsb.c",
    "exported/src/dwarf/Lfind_unwind_table.c",
    "exported/src/dwarf/Lparser.c",
    "exported/src/dwarf/Lpe.c",
    "exported/src/dwarf/Lstep.c",

    # elf64
    "exported/src/elf64.c",
    "exported/src/elf64.h",
    "exported/src/elfxx.h",

    # libunwind-x86_64
    "exported/src/mi/Gdyn-extract.c",
    "exported/src/mi/Gdyn-remote.c",
    "exported/src/mi/Gfind_dynamic_proc_info.c",
    "exported/src/mi/Gget_proc_info_by_ip.c",
    "exported/src/mi/Gget_proc_name.c",
    "exported/src/mi/Gput_dynamic_unwind_info.c",
    "exported/src/mi/Gdestroy_addr_space.c",
    "exported/src/mi/Gget_reg.c",
    "exported/src/mi/Gset_reg.c",
    "exported/src/mi/Gget_fpreg.c",
    "exported/src/mi/Gset_fpreg.c",
    "exported/src/mi/Gset_caching_policy.c",
    "exported/src/mi/init.c",
    "exported/src/mi/flush_cache.c",
    "exported/src/mi/mempool.c",
    "exported/src/mi/strerror.c",
    "exported/src/os-linux.c",
    "exported/src/x86_64/Gcreate_addr_space.c",
    "exported/src/x86_64/Gget_save_loc.c",
    "exported/src/x86_64/Gglobal.c",
    "exported/src/x86_64/Ginit.c",
    "exported/src/x86_64/Ginit_local.c",
    "exported/src/x86_64/Ginit_remote.c",
    "exported/src/x86_64/Gget_proc_info.c",
    "exported/src/x86_64/Gregs.c",
    "exported/src/x86_64/Gresume.c",
    "exported/src/x86_64/Gstash_frame.c",
    "exported/src/x86_64/Gstep.c",
    "exported/src/x86_64/Gtrace.c",
    "exported/src/x86_64/Gos-linux.c",
    "exported/src/x86_64/is_fpreg.c",
    "exported/src/x86_64/regname.c",
  ]

  cflags = [
    "-fexceptions",
    "-fPIC",
    "-Wall",
    "-Wsign-compare",
    "-Wno-absolute-value",
    "-Wno-header-guard",
  ]

  defines = [
    "_GNU_SOURCE",
    "CONSERVATIVE_CHECKS",
    "HAVE___THREAD",
    "HAVE__BUILTIN___CLEAR_CACHE",
    "HAVE__BUILTIN_UNREACHABLE",
    "HAVE_BYTESWAP_H",
    "HAVE_DECL_PT_CONTINUE",
    "HAVE_DECL_PT_GETFPREGS",
    "HAVE_DECL_PT_GETREGS",
    "HAVE_DECL_PT_STEP",
    "HAVE_DECL_PT_SYSCALL",
    "HAVE_DECL_PT_TRACE_ME",
    "HAVE_DECL_PTRACE_CONT",
    "HAVE_DECL_PTRACE_POKEDATA",
    "HAVE_DECL_PTRACE_POKEUSER",
    "HAVE_DECL_PTRACE_SINGLESTEP",
    "HAVE_DECL_PTRACE_SYSCALL",
    "HAVE_DECL_PTRACE_TRACEME",
    "HAVE_DL_ITERATE_PHDR",
    "HAVE_DLFCN_H",
    "HAVE_ELF_H",
    "HAVE_ENDIAN_H",
    "HAVE_EXECINFO_H",
    "HAVE_INTTYPES_H",
    "HAVE_LINK_H",
    "HAVE_LZMA",
    "HAVE_MEMORY_H",
    "HAVE_MINCORE",
    "HAVE_SIGNAL_H",
    "HAVE_STDINT_H",
    "HAVE_STDLIB_H",
    "HAVE_STRING_H",
    "HAVE_STRINGS_H",
    "HAVE_STRUCT_DL_PHDR_INFO_DLPI_SUBS",
    "HAVE_STRUCT_ELF_PRSTATUS",
    "HAVE_SYNC_ATOMICS",
    "HAVE_SYS_PROCFS_H",
    "HAVE_SYS_PTRACE_H",
    "HAVE_SYS_STAT_H",
    "HAVE_SYS_TYPES_H",
    "HAVE_UNISTD_H",
    "PACKAGE_BUGREPORT=\"libunwind-devel@nongnu.org\"",
    "PACKAGE_STRING =\"libunwind 1.1\"",
    "SIZEOF_OFF_T=8",
    "STDC_HEADERS",
  ]

  include_dirs = [
    "exported/include",
    "exported/include/tdep-x86_64",
    "exported/src",
    "stubs",
  ]

  libs = [
    "c",
    "lzma",
  ]

  configs = []
  deps = []
}
