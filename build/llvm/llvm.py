import os
import subprocess


def defines():
    flags = subprocess.check_output(
        ['llvm-config', '--cxxflags']).strip().split()
    for flag in flags:
        if flag.startswith('-D'):
            yield flag[2:]


def libs():
    flags = subprocess.check_output(['llvm-config', '--libs']).strip().split()
    for flag in flags:
        if flag.startswith('-l'):
            yield flag[2:]


def system_libs():
    flags = subprocess.check_output(
        ['llvm-config', '--system-libs']).strip().split()
    for flag in flags:
        if flag.startswith('-l'):
            yield flag[2:]


script_path = os.path.dirname(os.path.realpath(__file__))
with open(os.path.join(script_path, 'llvm.gni'), 'w') as f:
    f.write('# Auto-generated by llvm.py - DO NOT EDIT!\n')
    f.write('\n')
    f.write('llvm_defines = [\n')
    for define in defines():
        f.write('  "' + define + '",\n')
    f.write(']\n')
    f.write('\n')
    f.write('llvm_libs = [\n')
    for lib in libs():
        f.write('  "' + lib + '",\n')
    f.write(']\n')
    f.write('\n')
    f.write('llvm_system_libs = [\n')
    for lib in system_libs():
        f.write('  "' + lib + '",\n')
    f.write(']\n')
