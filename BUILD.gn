group("All") {
  deps = [
    "//src/client:clang",
    "//src/daemon:clangd",
  ]
}

group("Tests") {
  deps = [
    "//src/test:unit_tests",
  ]
}

if (os == "linux") {
  action("deb_package") {
    script = "//build/deb_package.py"
    sources = [
      "//build/common_package.include",
      "//build/deb_changelog.template",
      "//build/deb_control.template",
      "//build/expand_env_vars.sh",
      "//install/clangd.conf",
      "//install/clangd_init_d",
      "//install/clangd_wrapper",
      "//src/daemon/configuration_pb2.py",
      "//src/proto/base_pb2.py",
      "$root_out_dir/clang",
      "$root_out_dir/clangd",
      "$root_out_dir/lib/libbase.so",
      "$root_out_dir/lib/libc++.so",
      "$root_out_dir/lib/libcommand.so",
      "$root_out_dir/lib/libconfiguration.so",
      "$root_out_dir/lib/libconstants.so",
      "$root_out_dir/lib/libfile_cache.so",
      "$root_out_dir/lib/libhistogram.so",
      "$root_out_dir/lib/libkyotocabinet.so",
      "$root_out_dir/lib/liblogging.so",
      "$root_out_dir/lib/libmanifest.so",
      "$root_out_dir/lib/libnet.so",
      "$root_out_dir/lib/libproto.so",
    ]
    outputs = [
      "$root_out_dir/deb/debian/control",
      "$root_out_dir/deb/debian/changelog",
      "$root_out_dir/deb/debian/files",
      "$root_out_dir/deb/debian/tmp/etc/clangd.conf",
      "$root_out_dir/deb/debian/tmp/etc/init.d/clangd",
      "$root_out_dir/deb/debian/tmp/usr/bin/dist-clang/clang",
      "$root_out_dir/deb/debian/tmp/usr/bin/dist-clang/clang++",
      "$root_out_dir/deb/debian/tmp/usr/bin/dist-clang/clangd",
      "$root_out_dir/deb/debian/tmp/usr/bin/dist-clang/clangd_wrapper",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libbase.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libc++.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libcommand.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libconfiguration.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libconstants.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libfile_cache.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libhistogram.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libkyotocabinet.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/liblogging.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libmanifest.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libnet.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/dist-clang/libproto.so",
      "$root_out_dir/deb/debian/tmp/usr/lib/python2.7/dist_clang/__init__.py",
      "$root_out_dir/deb/debian/tmp/usr/lib/python2.7/dist_clang/daemon/__init__.py",
      "$root_out_dir/deb/debian/tmp/usr/lib/python2.7/dist_clang/daemon/configuration_pb2.py",
      "$root_out_dir/deb/debian/tmp/usr/lib/python2.7/dist_clang/proto/__init__.py",
      "$root_out_dir/deb/debian/tmp/usr/lib/python2.7/dist_clang/proto/base_pb2.py",
      "$root_out_dir/deb/debian/tmp/DEBIAN/control",
      "$root_out_dir/dist-clang_${version}_amd64.deb",
      "$root_out_dir/dist-clang_${version}_amd64.changes",
    ]
    args = [
      rebase_path("$root_out_dir"),
      "$version",
    ]
  }

  action("rpm_package") {
    script = "//build/rpm_package.py"
    sources = [
      "//build/common_package.include",
      "//build/rpm_spec.template",
      "//build/expand_env_vars.sh",
      "//install/clangd.conf",
      "//install/clangd.service",
      "//install/clangd_wrapper",
      "//src/daemon/configuration_pb2.py",
      "//src/proto/base_pb2.py",
      "$root_out_dir/clang",
      "$root_out_dir/clangd",
      "$root_out_dir/lib/libbase.so",
      "$root_out_dir/lib/libc++.so",
      "$root_out_dir/lib/libcommand.so",
      "$root_out_dir/lib/libconfiguration.so",
      "$root_out_dir/lib/libconstants.so",
      "$root_out_dir/lib/libfile_cache.so",
      "$root_out_dir/lib/libhistogram.so",
      "$root_out_dir/lib/libkyotocabinet.so",
      "$root_out_dir/lib/liblogging.so",
      "$root_out_dir/lib/libmanifest.so",
      "$root_out_dir/lib/libnet.so",
      "$root_out_dir/lib/libproto.so",
    ]
    outputs = [
      "$root_out_dir/rpm.spec",
      "$root_out_dir/rpm/etc/clangd.conf",
      "$root_out_dir/rpm/etc/init.d/clangd",
      "$root_out_dir/rpm/usr/bin/dist-clang/clang",
      "$root_out_dir/rpm/usr/bin/dist-clang/clang++",
      "$root_out_dir/rpm/usr/bin/dist-clang/clangd",
      "$root_out_dir/rpm/usr/bin/dist-clang/clangd_wrapper",
      "$root_out_dir/rpm/usr/lib/dist-clang/libbase.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/libc++.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/libcommand.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/libconfiguration.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/libconstants.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/libfile_cache.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/libhistogram.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/libkyotocabinet.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/liblogging.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/libmanifest.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/libnet.so",
      "$root_out_dir/rpm/usr/lib/dist-clang/libproto.so",
      "$root_out_dir/rpm/usr/lib/python2.7/dist_clang/__init__.py",
      "$root_out_dir/rpm/usr/lib/python2.7/dist_clang/daemon/__init__.py",
      "$root_out_dir/rpm/usr/lib/python2.7/dist_clang/daemon/configuration_pb2.py",
      "$root_out_dir/rpm/usr/lib/python2.7/dist_clang/proto/__init__.py",
      "$root_out_dir/rpm/usr/lib/python2.7/dist_clang/proto/base_pb2.py",
      "$root_out_dir/rpmbuild/RPMS/x86_64/dist-clang-${version}-1.x86_64.rpm",
    ]
    args = [
      rebase_path("$root_out_dir"),
      "$version",
    ]
  }
}
